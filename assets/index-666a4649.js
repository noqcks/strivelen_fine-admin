import{r as a,at as le,j as i,au as s,bg as ce,bh as E,aK as V,aJ as me,as as I,aa as Me,aP as G,bi as ie,aS as se,am as J,aA as ue,ao as U,ad as ke,aq as we,O as K,Q as B}from"./vendor-1a382111.js";import{u as De,C as _e,a as $e}from"./index-6efb831b.js";import{w as Ae,B as We,_ as Be,a as Q,h as Ee,m as Ie}from"./index-22b2adee.js";var je=["onFinish","step","formRef","title","stepProps"];function Le(o){var c=a.useRef(),t=a.useContext(de),u=o.onFinish,k=o.step,j=o.formRef;o.title,o.stepProps;var f=le(o,je);return Ae.noteOnce(!f.submitter,"StepForm 不包含提交按钮，请在 StepsForm 上"),a.useImperativeHandle(j,function(){return c.current}),a.useEffect(function(){if(o.name||o.step){var e=(o.name||o.step).toString();return t==null||t.regForm(e,o),function(){t==null||t.unRegForm(e)}}},[]),t&&(t!=null&&t.formArrayRef)&&(t.formArrayRef.current[k||0]=c),i(We,s({formRef:c,onFinish:function(){var e=ce(E().mark(function S(x){var v;return E().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(f.name&&(t==null||t.onFormFinish(f.name,x)),!u){h.next=9;break}return t==null||t.setLoading(!0),h.next=5,u==null?void 0:u(x);case 5:return v=h.sent,v&&(t==null||t.next()),t==null||t.setLoading(!1),h.abrupt("return");case 9:t!=null&&t.lastStep||t==null||t.next();case 10:case"end":return h.stop()}},S)}));function g(S){return e.apply(this,arguments)}return g}(),layout:"vertical"},f))}var Ne=function(c){return V({},c.componentCls,{"&-container":{width:"max-content",minWidth:"520px",maxWidth:"100%",margin:"auto"},"&-steps-container":V({maxWidth:"1160px",margin:"auto"},"".concat(c.antCls,"-steps-vertical"),{height:"100%"}),"&-step":{display:"none",marginBlockStart:"32px","&-active":{display:"block"},"> form":{maxWidth:"100%"}}})};function ze(o){return De("StepsForm",function(c){var t=s(s({},c),{},{componentCls:".".concat(o)});return[Ne(t)]})}var He=["current","onCurrentChange","submitter","stepsFormRender","stepsRender","stepFormRender","stepsProps","onFinish","formProps","containerStyle","formRef","formMapRef"],de=I.createContext(void 0),Te={horizontal:function(c){var t=c.stepsDom,u=c.formDom;return U(we,{children:[i(K,{gutter:{xs:8,sm:16,md:24},children:i(B,{span:24,children:t})}),i(K,{gutter:{xs:8,sm:16,md:24},children:i(B,{span:24,children:u})})]})},vertical:function(c){var t=c.stepsDom,u=c.formDom;return U(K,{align:"stretch",wrap:!0,gutter:{xs:8,sm:16,md:24},children:[i(B,{xxl:4,xl:6,lg:7,md:8,sm:10,xs:12,children:I.cloneElement(t,{style:{height:"100%"}})}),i(B,{children:i("div",{style:{display:"flex",alignItems:"center",width:"100%",height:"100%"},children:u})})]})}};function Oe(o){var c=a.useContext(Me.ConfigContext),t=c.getPrefixCls,u=t("pro-steps-form"),k=ze(u),j=k.wrapSSR,f=k.hashId;o.current,o.onCurrentChange;var e=o.submitter,g=o.stepsFormRender,S=o.stepsRender,x=o.stepFormRender,v=o.stepsProps,w=o.onFinish,h=o.formProps,X=o.containerStyle,ve=o.formRef,pe=o.formMapRef,he=le(o,He),L=a.useRef(new Map),R=a.useRef(new Map),y=a.useRef([]),ge=a.useState([]),Y=G(ge,2),p=Y[0],Z=Y[1],Fe=a.useState(!1),ee=G(Fe,2),P=ee[0],D=ee[1],b=$e(),Se=Be(0,{value:o.current,onChange:o.onCurrentChange}),re=G(Se,2),l=re[0],_=re[1],N=a.useMemo(function(){return Te[(v==null?void 0:v.direction)||"horizontal"]},[v==null?void 0:v.direction]),z=a.useMemo(function(){return l===p.length-1},[p.length,l]),Re=a.useCallback(function(r,n){R.current.has(r)||Z(function(d){return[].concat(ie(d),[r])}),R.current.set(r,n)},[]),ye=a.useCallback(function(r){Z(function(n){return n.filter(function(d){return d!==r})}),R.current.delete(r),L.current.delete(r)},[]);a.useImperativeHandle(pe,function(){return y.current}),a.useImperativeHandle(ve,function(){var r;return(r=y.current[l||0])===null||r===void 0?void 0:r.current},[l]);var be=a.useCallback(function(){var r=ce(E().mark(function n(d,F){var M,W;return E().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(L.current.set(d,F),!(!z||!w)){m.next=3;break}return m.abrupt("return");case 3:return D(!0),M=Ie.apply(void 0,[{}].concat(ie(Array.from(L.current.values())))),m.prev=5,m.next=8,w(M);case 8:W=m.sent,W&&(_(0),y.current.forEach(function(Pe){var q;return(q=Pe.current)===null||q===void 0?void 0:q.resetFields()})),m.next=15;break;case 12:m.prev=12,m.t0=m.catch(5),console.log(m.t0);case 15:return m.prev=15,D(!1),m.finish(15);case 18:case"end":return m.stop()}},n,null,[[5,12,15,18]])}));return function(n,d){return r.apply(this,arguments)}}(),[z,w,D,_]),H=a.useMemo(function(){return i("div",{className:"".concat(u,"-steps-container ").concat(f),style:{maxWidth:Math.min(p.length*320,1160)},children:i(se,s(s({},v),{},{current:l,onChange:void 0,children:p.map(function(r){var n=R.current.get(r);return i(se.Step,s({title:n==null?void 0:n.title},n==null?void 0:n.stepProps),r)})}))})},[p,f,u,l,v]),C=Q(function(){var r,n=y.current[l];(r=n.current)===null||r===void 0||r.submit()}),$=Q(function(){l<1||_(l-1)}),T=a.useMemo(function(){return e!==!1&&i(J,s(s({type:"primary",loading:P},e==null?void 0:e.submitButtonProps),{},{onClick:function(){var n;e==null||(n=e.onSubmit)===null||n===void 0||n.call(e),C()},children:b.getMessage("stepsForm.next","下一步")}),"next")},[b,P,C,e]),O=a.useMemo(function(){return e!==!1&&i(J,s(s({},e==null?void 0:e.resetButtonProps),{},{onClick:function(){var n;$(),e==null||(n=e.onReset)===null||n===void 0||n.call(e)},children:b.getMessage("stepsForm.prev","上一步")}),"pre")},[b,$,e]),ne=a.useMemo(function(){return e!==!1&&i(J,s(s({type:"primary",loading:P},e==null?void 0:e.submitButtonProps),{},{onClick:function(){var n;e==null||(n=e.onSubmit)===null||n===void 0||n.call(e),C()},children:b.getMessage("stepsForm.submit","提交")}),"submit")},[b,P,C,e]),Ce=Q(function(){l>p.length-2||_(l+1)}),A=a.useMemo(function(){var r=[],n=l||0;if(n<1?r.push(T):n+1===p.length?r.push(O,ne):r.push(O,T),r=r.filter(I.isValidElement),e&&e.render){var d,F={form:(d=y.current[l])===null||d===void 0?void 0:d.current,onSubmit:C,step:l,onPre:$};return e.render(F,r)}return e&&(e==null?void 0:e.render)===!1?null:r},[p.length,T,C,O,$,l,ne,e]),te=a.useMemo(function(){return Ee(o.children).map(function(r,n){var d=r.props,F=d.name||"".concat(n),M=l===n,W=M?{contentRender:x,submitter:!1}:{};return i("div",{className:ue("".concat(u,"-step"),f,V({},"".concat(u,"-step-active"),M)),children:I.cloneElement(r,s(s(s(s({},W),h),d),{},{name:F,step:n,key:F}))},F)})},[h,f,u,o.children,l,x]),oe=a.useMemo(function(){return S?S(p.map(function(r){var n;return{key:r,title:(n=R.current.get(r))===null||n===void 0?void 0:n.title}}),H):H},[p,H,S]),ae=a.useMemo(function(){return U("div",{className:"".concat(u,"-container ").concat(f),style:X,children:[te,g?null:i(ke,{children:A})]})},[X,te,f,u,g,A]),xe=a.useMemo(function(){var r={stepsDom:oe,formDom:ae};return g?g(N(r),A):N(r)},[oe,ae,N,g,A]);return j(i("div",{className:ue(u,f),children:i(me.Provider,s(s({},he),{},{children:i(de.Provider,{value:{loading:P,setLoading:D,regForm:Re,keyArray:p,next:Ce,formArrayRef:y,formMapRef:R,lastStep:z,unRegForm:ye,onFormFinish:be},children:xe})}))}))}function fe(o){return i(_e,{needDeps:!0,children:i(Oe,s({},o))})}fe.StepForm=Le;fe.useForm=me.useForm;export{fe as S};
